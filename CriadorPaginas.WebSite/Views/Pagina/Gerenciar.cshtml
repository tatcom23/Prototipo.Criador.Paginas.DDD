@model Paginas.Application.DTOs.PaginaDTO

@{ ViewData["Title"] = "Gerenciar Página"; }

<h1 class="mb-3">Gerenciar: @Model.Titulo</h1>

<div class="mb-3">
    <a asp-action="Listar" class="btn btn-outline-secondary">← Voltar à lista</a>
</div>

<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <strong>Página:</strong> @Model.Titulo
    </div>
    <div class="card-body">
        <p><strong>Conteúdo:</strong></p>
        <div class="border rounded p-3 mb-3">
            @Html.Raw(Model.Conteudo)
        </div>

        <p><strong>URL:</strong> @Model.Url</p>
        <p><strong>Banner:</strong> @Model.Banner</p>

        <div class="mt-3 d-flex flex-wrap gap-2">
            <a asp-action="Editar" asp-route-id="@Model.Codigo" class="btn btn-sm btn-warning">Editar</a>
            <a asp-action="Detalhes" asp-route-id="@Model.Codigo" class="btn btn-sm btn-info">Detalhes</a>
            <a asp-action="Excluir" asp-route-id="@Model.Codigo" class="btn btn-sm btn-danger">Excluir</a>
            <a asp-action="Exibir" asp-route-id="@Model.Url" class="btn btn-sm btn-success" target="_blank">Exibir</a>
        </div>

        <hr />

        <h5>Botões da Página</h5>
        @if (Model.Botoes != null && Model.Botoes.Any())
        {
<ul>
    @foreach (var botao in Model.Botoes)
    {
<li class="mb-2">
    <strong>@botao.Nome</strong> &nbsp;→&nbsp;
    <a href="@botao.Link" target="_blank">@botao.Link</a>
    <small class="text-muted"> (Linha: @botao.Linha, Coluna: @botao.Coluna)</small>

    <div class="mt-1">
        <a asp-controller="Botao" asp-action="Editar" asp-route-id="@botao.Codigo" class="btn btn-sm btn-outline-warning ms-2">✏️</a>
        <a asp-controller="Botao" asp-action="Excluir" asp-route-id="@botao.Codigo" class="btn btn-sm btn-outline-danger ms-1">🗑️</a>
    </div>
</li>                }
</ul> }
            else
            {
<p><em>Sem botões.</em></p>}

        <h5 class="mt-4">Tópicos</h5>
        @if (Model.PaginaFilhos != null && Model.PaginaFilhos.Any())
        {
@for (int i = 0; i < Model.PaginaFilhos.Count; i++)
{
    var topico = Model.PaginaFilhos[i];
<div class="border-start border-3 ps-3 mb-3">
    <hr />
    <h6><strong>Tópico:</strong> @topico.Titulo</h6>
    <p><strong>Ordem:</strong> @topico.Ordem</p>
    <p><strong>Conteúdo:</strong></p>
    <div class="border rounded p-3 mb-2">
        @Html.Raw(topico.Conteudo)
    </div>
    <p><strong>URL:</strong> @topico.Url</p>
    <p><strong>Banner:</strong> @topico.Banner</p>

    <div class="mb-2">
        @if (i > 0)
        {
<form asp-action="AtualizarOrdem" asp-controller="Pagina" method="post" class="d-inline">
    <input type="hidden" name="idA" value="@Model.PaginaFilhos[i].Codigo" />
    <input type="hidden" name="idB" value="@Model.PaginaFilhos[i-1].Codigo" />
    <button type="submit" class="btn btn-sm btn-outline-secondary">🔼</button>
</form>}
        @if (i < Model.PaginaFilhos.Count - 1)
        {
<form asp-action="AtualizarOrdem" asp-controller="Pagina" method="post" class="d-inline ms-1">
    <input type="hidden" name="idA" value="@Model.PaginaFilhos[i].Codigo" />
    <input type="hidden" name="idB" value="@Model.PaginaFilhos[i+1].Codigo" />
    <button type="submit" class="btn btn-sm btn-outline-secondary">🔽</button>
</form>}

        <a asp-action="Editar" asp-route-id="@topico.Codigo" class="btn btn-sm btn-warning ms-2">✏️ Editar</a>
        <a asp-action="Excluir" asp-route-id="@topico.Codigo" class="btn btn-sm btn-danger ms-1">🗑️ Excluir</a>
    </div>

    <strong>Botões do Tópico:</strong>
    @if (topico.Botoes != null && topico.Botoes.Any())
    {
<ul>
    @foreach (var b in topico.Botoes)
    {
<li>
    <strong>@b.Nome</strong> → <a href="@b.Link" target="_blank">@b.Link</a>
    <small class="text-muted"> (Linha: @b.Linha, Coluna: @b.Coluna)</small>
    <a asp-controller="Botao" asp-action="Editar" asp-route-id="@b.Codigo" class="btn btn-sm btn-outline-warning ms-2">✏️</a>
    <a asp-controller="Botao" asp-action="Excluir" asp-route-id="@b.Codigo" class="btn btn-sm btn-outline-danger ms-1">🗑️</a>
</li>}
</ul> }
                    else
                    {
<p><em>Sem botões nesse tópico.</em></p>                    }
</div>} }
            else
            {
<p><em>Sem tópicos vinculados.</em></p>}
    </div>
</div>
