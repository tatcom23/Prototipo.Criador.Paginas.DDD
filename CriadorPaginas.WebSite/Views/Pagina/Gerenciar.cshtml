@model Paginas.Application.DTOs.PaginaDTO
@{ ViewData["Title"] = "Gerenciar Página"; }

<h1 class="mb-3">Página: @Model.Titulo</h1>

<div class="mb-3">
    <a asp-action="Listar" class="btn btn-outline-secondary">← Voltar à lista</a>
</div>

<div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
        <strong>Página:</strong> @Model.Titulo
    </div>
    <div class="card-body">
        <div class="mb-3 border rounded p-3 shadow-sm">
            <p><strong>Descrição:</strong></p>
            <div class="border rounded p-3 mb-3">
                @Html.Raw(Model.Conteudo)
            </div>

            <p><strong>URL de acesso:</strong> @Model.Url</p>
            <p><strong>Banner principal:</strong> @Model.Banner</p>

            <div class="mt-3 d-flex gap-2">
                <a asp-action="Editar" asp-route-id="@Model.Codigo" class="btn btn-sm btn-warning">Editar</a>
                <a asp-action="Excluir" asp-route-id="@Model.Codigo" class="btn btn-sm btn-danger mx-1">Excluir</a>
                <a asp-action="Exibir" asp-route-id="@Model.Url" class="btn btn-sm btn-success" target="_blank">Exibir</a>
            </div>
        </div>

        <h5>Botões de navegação da página</h5>
        @if (Model.Botoes != null && Model.Botoes.Any())
        {
<ul class="list-unstyled">
    @foreach (var botao in Model.Botoes)
    {
<li class="mb-2 border rounded p-2 shadow-sm">
    <strong>@botao.Nome</strong> &nbsp;→&nbsp;
    <a href="@botao.Link" target="_blank">@botao.Link</a>
    <small class="text-muted"> (Linha: @botao.Linha, Coluna: @botao.Coluna)</small>
    <div class="mt-1 d-flex gap-1">
        <a asp-controller="Botao" asp-action="Editar" asp-route-id="@botao.Codigo" class="btn btn-sm btn-outline-warning">✏️</a>
        <a asp-controller="Botao" asp-action="Excluir" asp-route-id="@botao.Codigo" class="btn btn-sm btn-outline-danger mx-1">🗑️</a>
    </div>
</li>                }
</ul> }
            else
            {
<p><em>Sem botões.</em></p>}

        <h5 class="mt-4">Tópicos</h5>
        @if (Model.PaginaFilhos != null && Model.PaginaFilhos.Any())
        {
@for (int i = 0; i < Model.PaginaFilhos.Count; i++)
{
    var topico = Model.PaginaFilhos[i];
<div class="card mb-3 shadow-sm">
    <div class="card-body">
        <h6><strong>Título do tópico:</strong> @topico.Titulo</h6>
        <p><strong>Ordem de visualização do tópico:</strong> @topico.Ordem</p>
        <p><strong>Descrição do tópico:</strong></p>
        <div class="border rounded p-3 mb-2">
            @Html.Raw(topico.Conteudo)
        </div>

        <div class="d-flex gap-2 mb-2">
            @if (i > 0)
            {
            <form asp-action="AtualizarOrdem" asp-controller="Pagina" method="post" class="d-inline">
                <input type="hidden" name="idA" value="@topico.Codigo" />
                <input type="hidden" name="idB" value="@Model.PaginaFilhos[i-1].Codigo" />
                <input type="hidden" name="paginaId" value="@Model.Codigo" />
                <button type="submit" class="btn btn-sm btn-outline-secondary mx-1">🔼</button>
            </form>}
            @if (i < Model.PaginaFilhos.Count - 1)
            {
        <form asp-action="AtualizarOrdem" asp-controller="Pagina" method="post" class="d-inline">
            <input type="hidden" name="idA" value="@topico.Codigo" />
            <input type="hidden" name="idB" value="@Model.PaginaFilhos[i+1].Codigo" />
            <input type="hidden" name="paginaId" value="@Model.Codigo" />
            <button type="submit" class="btn btn-sm btn-outline-secondary mx-1">🔽</button>
        </form>}

            <a asp-action="Editar" asp-route-id="@topico.Codigo" class="btn btn-sm btn-warning">✏️ Editar</a>
            <a asp-action="Excluir" asp-route-id="@topico.Codigo" class="btn btn-sm btn-danger mx-1">🗑️ Excluir</a>
        </div>

        <strong>Botões de navegação do tópico:</strong>
        @if (topico.Botoes != null && topico.Botoes.Any())
        {
<ul class="list-unstyled">
    @foreach (var b in topico.Botoes)
    {
<li class="mb-1 d-flex align-items-center gap-1">
    <strong>@b.Nome</strong> → <a href="@b.Link" target="_blank">@b.Link</a>
    <small class="text-muted"> (Linha: @b.Linha, Coluna: @b.Coluna)</small>
    <a asp-controller="Botao" asp-action="Editar" asp-route-id="@b.Codigo" class="btn btn-sm btn-outline-warning mx-1">✏️</a>
    <a asp-controller="Botao" asp-action="Excluir" asp-route-id="@b.Codigo" class="btn btn-sm btn-outline-danger">🗑️</a>
</li>}
</ul> }
                    else
                    {
<p><em>Sem botões nesse tópico.</em></p>}
    </div>
</div>} }
            else
            {
<p><em>Sem tópicos vinculados.</em></p>}
    </div>
</div>
