@model List<Paginas.Application.DTOs.PaginaDTO>

@{ ViewData["Title"] = "Lista de Páginas"; }

<h1>Lista de Páginas</h1>

<a asp-action="Index" class="btn btn-primary mb-3">Nova Página</a>

@foreach (var pagina in Model.Where(p => p.CdPai == null))
{
<div class="card mb-4">
    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
        <strong>Página:</strong> @pagina.Titulo
        <button class="btn btn-sm btn-light toggle-content" data-target="pagina-@pagina.Codigo">
            ▼ Expandir
        </button>
    </div>
    <div class="card-body" id="pagina-@pagina.Codigo" style="display: none;">
        <p><strong>Conteúdo:</strong> @pagina.Conteudo</p>
        <p><strong>URL:</strong> @pagina.Url</p>
        <p><strong>Banner:</strong> @pagina.Banner</p>

        <h5>Botões da Página</h5>
        @if (pagina.Botoes != null && pagina.Botoes.Any())
        {
<ul>
    @foreach (var botao in pagina.Botoes)
    {
<li>
    <strong>@botao.Nome</strong> → <a href="@botao.Link" target="_blank">@botao.Link</a>
    (Linha: @botao.Linha, Coluna: @botao.Coluna)
    <a asp-controller="Botao" asp-action="Editar" asp-route-id="@botao.Codigo" class="btn btn-sm btn-outline-warning ms-2">✏️</a>
    <a asp-controller="Botao" asp-action="Excluir" asp-route-id="@botao.Codigo" class="btn btn-sm btn-outline-danger ms-1">🗑️</a>
</li>                    }
</ul> }
                else
                {
<p><em>Sem botões.</em></p>}

        <h5 class="mt-4">Tópicos</h5>
        @if (pagina.PaginaFilhos != null && pagina.PaginaFilhos.Any())
        {
@for (int i = 0; i < pagina.PaginaFilhos.Count; i++)
{
    var topico = pagina.PaginaFilhos[i];
<div class="border-start border-3 ps-3 mb-3">
    <hr />
    <h6><strong>Tópico:</strong> @topico.Titulo</h6>
    <p><strong>Ordem:</strong> @topico.Ordem</p>
    <p><strong>Conteúdo:</strong> @topico.Conteudo</p>
    <p><strong>URL:</strong> @topico.Url</p>
    <p><strong>Banner:</strong> @topico.Banner</p>

    <div class="mb-2">
        @if (i > 0)
        {
<a asp-controller="Pagina" asp-action="MoverParaCima" asp-route-id="@topico.Codigo" class="btn btn-sm btn-outline-secondary">🔼</a>}
        @if (i < pagina.PaginaFilhos.Count - 1)
        {
<a asp-controller="Pagina" asp-action="MoverParaBaixo" asp-route-id="@topico.Codigo" class="btn btn-sm btn-outline-secondary ms-1">🔽</a>}
        <a asp-action="Editar" asp-route-id="@topico.Codigo" class="btn btn-sm btn-warning ms-2">✏️ Editar</a>
        <a asp-action="Excluir" asp-route-id="@topico.Codigo" class="btn btn-sm btn-danger ms-1">🗑️ Excluir</a>
    </div>

    <strong>Botões do Tópico:</strong>
    @if (topico.Botoes != null && topico.Botoes.Any())
    {
<ul>
    @foreach (var b in topico.Botoes)
    {
<li>
    <strong>@b.Nome</strong> → <a href="@b.Link" target="_blank">@b.Link</a>
    (Linha: @b.Linha, Coluna: @b.Coluna)
    <a asp-controller="Botao" asp-action="Editar" asp-route-id="@b.Codigo" class="btn btn-sm btn-outline-warning ms-2">✏️</a>
    <a asp-controller="Botao" asp-action="Excluir" asp-route-id="@b.Codigo" class="btn btn-sm btn-outline-danger ms-1">🗑️</a>
</li>}
</ul> }
                        else
                        {
<p><em>Sem botões nesse tópico.</em></p>                        }
</div>} }
                else
                {
<p><em>Sem tópicos vinculados.</em></p>}

        <hr />
        <div class="mt-3">
            <a asp-action="Editar" asp-route-id="@pagina.Codigo" class="btn btn-sm btn-warning">Editar</a>
            <a asp-action="Detalhes" asp-route-id="@pagina.Codigo" class="btn btn-sm btn-info">Detalhes</a>
            <a asp-action="Excluir" asp-route-id="@pagina.Codigo" class="btn btn-sm btn-danger">Excluir</a>
            <a asp-action="Exibir" asp-route-id="@pagina.Url" class="btn btn-sm btn-success" target="_blank">Exibir</a>
        </div>
    </div>
</div>}

@section Scripts {
    <script>document.querySelectorAll('.toggle-content').forEach(button => {
            button.addEventListener('click', function () {
                const targetId = this.getAttribute('data-target');
                const content = document.getElementById(targetId);
                const isExpanded = content.style.display === 'block';

                if (isExpanded) {
                    content.style.display = 'none';
                    this.textContent = '▼ Expandir';
                    this.classList.remove('btn-dark');
                    this.classList.add('btn-light');
                } else {
                    content.style.display = 'block';
                    this.textContent = '▲ Recolher';
                    this.classList.remove('btn-light');
                    this.classList.add('btn-dark');
                }
            });
        });</script>
}
