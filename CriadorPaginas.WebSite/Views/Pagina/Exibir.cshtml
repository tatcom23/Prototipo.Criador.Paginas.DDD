@model Paginas.Application.DTOs.PaginaDTO

@{
    ViewData["Title"] = Model.Titulo;

    var topicos = Model.PaginaFilhos?.OrderBy(t => t.Ordem).ToList() ?? new List<Paginas.Application.DTOs.PaginaDTO>();
    var botoesOrdenados = Model.Botoes?
        .OrderBy(b => b.Ordem)
        .ToList() ?? new List<Paginas.Application.DTOs.BotaoDTO>();
}

<div class="container py-5">

    <!-- Banner da Página -->
    @if (!string.IsNullOrEmpty(Model.Banner))
    {
        <img src="@Model.Banner" alt="Banner da página" class="img-fluid w-100 rounded mb-4 shadow-sm" />
    }

    <h1 class="text-center mb-4">@Model.Titulo</h1>

    <!-- Conteúdo da Página -->
    @if (!string.IsNullOrWhiteSpace(Model.Conteudo))
    {
        <div class="mb-5 content-wrapper">
            @Html.Raw(Model.Conteudo)
        </div>
    }

    <!-- Carrossel da Página -->
    @if (Model.Carrosseis != null && Model.Carrosseis.Any())
    {
        <div class="mb-5">
            @foreach (var c in Model.Carrosseis)
            {
                if (c.Imagens != null && c.Imagens.Any())
                {
                    var carouselId = $"carouselPagina-{c.Codigo}";
                    <div id="@carouselId" class="carousel slide mb-4 shadow-sm rounded" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            @for (int i = 0; i < c.Imagens.Count; i++)
                            {
                                var img = c.Imagens[i];
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@img.UrlImagem" class="d-block w-100 rounded" alt="@img.Titulo" style="max-height:400px; object-fit:cover;" />
                                    @if (!string.IsNullOrWhiteSpace(img.Titulo) || !string.IsNullOrWhiteSpace(img.Descricao))
                                    {
                                        <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                                            <small>@(img.Titulo ?? img.Descricao)</small>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Anterior</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Próximo</span>
                        </button>
                    </div>
                }
            }
        </div>
    }

    <!-- Botões principais -->
    @if (botoesOrdenados.Any())
    {
        <div class="btn-group-responsive mb-4 d-flex flex-wrap gap-2 justify-content-center">
            @foreach (var botao in botoesOrdenados)
            {
                <a href="@botao.Link" target="_blank" class="btn btn-primary px-4 py-2">
                    @botao.Nome
                </a>
            }
        </div>
    }

    <!-- Tópicos vinculados -->
    @if (topicos.Any())
    {
        <hr class="my-5" />

        @foreach (var t in topicos)
        {
            var anchorId = !string.IsNullOrWhiteSpace(t.Url)
            ? t.Url.ToLower().Replace(" ", "-")
            : $"topico-{t.Codigo}";

            var botoesTopicoOrdenados = t.Botoes?
            .OrderBy(b => b.Ordem)
            .ToList() ?? new List<Paginas.Application.DTOs.BotaoDTO>();

            <div id="@anchorId" class="mb-5 p-4 border rounded shadow-sm bg-white">

                <h4 class="w-100 text-start mb-3 px-3 py-2 text-white rounded" style="background-color:#028dcf;">
                    @t.Titulo
                </h4>

                <!-- Banner do tópico -->
                @if (!string.IsNullOrWhiteSpace(t.Banner))
                {
                    <div class="mb-3">
                        <img src="@t.Banner" class="img-fluid rounded shadow-sm" alt="Banner do tópico" />
                    </div>
                }

                <!-- Carrossel do tópico -->
                @if (t.Carrosseis != null && t.Carrosseis.Any())
                {
                    @foreach (var c in t.Carrosseis)
                    {
                        if (c.Imagens != null && c.Imagens.Any())
                        {
                            var carouselId = $"carouselTopico-{c.Codigo}";
                            <div id="@carouselId" class="carousel slide mb-4 shadow-sm rounded" data-bs-ride="carousel">
                                <div class="carousel-inner">
                                    @for (int i = 0; i < c.Imagens.Count; i++)
                                    {
                                        var img = c.Imagens[i];
                                        <div class="carousel-item @(i == 0 ? "active" : "")">
                                            <img src="@img.UrlImagem" class="d-block w-100 rounded" alt="@img.Titulo" style="max-height:300px; object-fit:cover;" />
                                            @if (!string.IsNullOrWhiteSpace(img.Titulo) || !string.IsNullOrWhiteSpace(img.Descricao))
                                            {
                                                <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                                                    <small>@(img.Titulo ?? img.Descricao)</small>
                                                </div>
                                            }
                                        </div>
                                    }
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#@carouselId" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Anterior</span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#@carouselId" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Próximo</span>
                                </button>
                            </div>
                        }
                    }
                }

                <!-- Conteúdo do tópico -->
                @if (!string.IsNullOrWhiteSpace(t.Conteudo))
                {
                    <div class="mb-3 content-wrapper">
                        @Html.Raw(t.Conteudo)
                    </div>
                }

                <!-- Botões do tópico -->
                @if (botoesTopicoOrdenados.Any())
                {
                    <div class="btn-group-responsive mb-3 d-flex flex-wrap gap-2">
                        @foreach (var botao in botoesTopicoOrdenados)
                        {
                            <a href="@botao.Link" target="_blank" class="btn btn-primary px-4 py-2">
                                @botao.Nome
                            </a>
                        }
                    </div>
                }
            </div>
        }
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
}
